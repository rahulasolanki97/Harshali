<!DOCTYPE html>
<html>
<head>
<title>Free Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:linear-gradient(90deg,#ffb6c1,#87ceeb);}
.card{background:#fff;padding:15px;margin:15px auto;width:380px;border-radius:10px;}
input,button{width:100%;padding:8px;margin:5px 0;}
button{background:#ff69b4;color:#fff;border:0;cursor:pointer}
.hide{display:none}
.box{background:#87ceeb;color:#fff;padding:10px;border-radius:8px}
.flex{display:flex;gap:10px}
</style>
</head>
<body>

<div class="card" id="auth">
<h3>Login / Signup</h3>
<input id="name" placeholder="Name (signup)">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
<button onclick="forgot()">Forgot Password</button>
</div>

<div class="card hide" id="app">
<h3>Dashboard</h3>
<div class="flex">
<div class="box">Daily ₹<span id="d">0</span></div>
<div class="box">Monthly ₹<span id="m">0</span></div>
<div class="box">Yearly ₹<span id="y">0</span></div>
</div>
<p>Total Income ₹<span id="inc">0</span></p>

<canvas id="pie"></canvas>

<h4>Add Expense</h4>
<input id="date" type="date">
<input id="desc" placeholder="Description">
<input id="cat" placeholder="Category">
<input id="amt" type="number" placeholder="Amount">
<button onclick="addExpense()">Add Expense</button>

<h4>Add Income</h4>
<input id="isource" placeholder="Income Source">
<input id="iamt" type="number" placeholder="Amount">
<button onclick="addIncome()">Add Income</button>

<ul id="list"></ul>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx5ZzUqyfBOvZFCgZdgt5Q8O1hvIF4Yn9EExJbcw9nGCCrIe4gQj6Xc-6jIHj-0RKfP/exec";
let user;

const call=d=>fetch(API,{method:"POST",body:JSON.stringify(d)}).then(r=>r.json());

function signup(){
  call({action:"signup",name:name.value,email:email.value,password:password.value})
  .then(r=>alert(r.success?"Signup successful":r.msg));
}

function login(){
  call({action:"login",email:email.value,password:password.value})
  .then(r=>{
    if(!r.success) return alert("Invalid login");
    user=r.user;
    auth.classList.add("hide");
    app.classList.remove("hide");
    load();
  });
}

function forgot(){
  call({action:"forgotPassword",email:email.value})
  .then(()=>alert("Temporary password sent to email"));
}

function load(){
  call({action:"dashboard",userId:user.id})
  .then(r=>{
    d.innerText=r.daily;
    m.innerText=r.monthly;
    y.innerText=r.yearly;
    inc.innerText=r.income;
  });

  call({action:"charts",userId:user.id})
  .then(r=>{
    new Chart(pie,{
      type:"pie",
      data:{labels:Object.keys(r.cat),
      datasets:[{data:Object.values(r.cat)}]}
    });
  });

  call({action:"getExpenses",userId:user.id})
  .then(r=>{
    list.innerHTML="";
    r.data.forEach(e=>{
      list.innerHTML+=
      `<li>${e[3]} ₹${e[5]}
      <button onclick="delE('${e[0]}')">❌</button></li>`;
    });
  });
}

function addExpense(){
  call({
    action:"addExpense",
    userId:user.id,
    date:date.value,
    description:desc.value,
    category:cat.value,
    amount:amt.value
  }).then(load);
}

function addIncome(){
  call({
    action:"addIncome",
    userId:user.id,
    date:new Date().toISOString().slice(0,10),
    source:isource.value,
    amount:iamt.value
  }).then(load);
}

function delE(id){
  call({action:"deleteExpense",id}).then(load);
}
</script>
</body>
</html>
